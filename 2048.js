function Board(){function a(){var a=document.getElementsByTagName("canvas")[0];a.width=B,a.height=B,w=a.getContext("2d"),s(),f(),p(),q(),window.onbeforeunload=function(){r()},J.onclick=c,K.onclick=o,document.onkeydown=function(a){"ArrowUp"===a.key?0===A&&t(T.UP):"ArrowDown"===a.key?0===A&&t(T.DOWN):"ArrowLeft"===a.key?0===A&&t(T.LEFT):"ArrowRight"===a.key&&0===A&&t(T.RIGHT)},window.addEventListener("touchstart",u,!1),window.addEventListener("touchmove",v,!1),void 0!==window.orientation&&(H.className+=" hide",J.className+=" hide")}function b(a){for(availableColor in E)E[availableColor]===a&&(w.fillStyle=E[availableColor])}function c(){for(var a=0;a<z.length;a++)z[a]=0,h(a);d(),x=0,p(),r()}function d(){var a=Math.floor(10*Math.random())+1,b=2;4===a&&(b=4);var c=e();z[c]=b,j(b,c)}function e(){for(var a=[],b=0;b<z.length;b++)0===z[b]&&a.push(b);return a[Math.floor(Math.random()*a.length)]}function f(){b(E.BORDER);for(var a=0;a<5;a++)w.fillRect(D*a+C*a,0,10,850),w.fillRect(0,D*a+C*a,850,10)}function g(a,b,c){function d(){setTimeout(function(){h(a);var b,l,n=k(a);e===T.LEFT?(b=n.x-g,l=n.y):e===T.RIGHT?(b=n.x+g,l=n.y):e===T.DOWN?(l=n.y+g,b=n.x):(l=n.y-g,b=n.x),f(),i(b,l,m(z[a]),z[a]),g+=14,g<=j?d():(f(),A--,c&&c())},1)}A++;var e=l(a,b),g=0,j=C+D;d()}function h(a){var c=k(a);b(E.BACKGROUND),w.fillRect(c.x,c.y,C,C)}function i(a,c,d,e){b(d),w.fillRect(a,c,C,C),b(e<8?E.TEXT_DARK:E.TEXT_LIGHT);var f=57;e<=8?f=80:3===(e+"").length?f=30:4===(e+"").length&&(f=10),w.font="80px Helvetica",w.fillText(e,a+f,c+125)}function j(a,b){var c=k(b);i(c.x,c.y,m(a),a)}function k(a){var b,c;return b=0===a||a%4==0?1*D+0*C:1===a||a%4==1?2*D+1*C:2===a||a%4==2?3*D+2*C:4*D+3*C,a<=3?c=1*D+0*C:a<=7?c=2*D+1*C:a<=11?c=3*D+2*C:a<=15&&(c=4*D+3*C),{x:b,y:c}}function l(a,b){return a+1===b?T.RIGHT:a-1===b?T.LEFT:b-4===a?T.DOWN:T.UP}function m(a){var b;switch(a){case 2:b=E.TWO;break;case 4:b=E.FOUR;break;case 8:b=E.EIGHT;break;case 16:b=E.SIXTEEN;break;case 32:b=E.THIRTYTWO;break;case 64:b=E.SIXTYFOUR;break;case 128:b=E.ONEHUNDREDTWENTYEIGHT;break;case 256:b=E.TWOHUNDREDFIFTYSIX;break;default:b=E.TWOHUNDREDFIFTYSIX}return b}function n(){K.className=K.className.replace("hide","").trim()}function o(){alert(K.className),K.className.indexOf("hide")===-1&&(alert("1"),K.className+=" hide")}function p(){H.children[1].children[0].innerHTML=x}function q(){H.children[0].children[0].innerHTML=y}function r(){if(I.supported()){x>y&&(y=x);var a={cells:z,score:x,highscore:y};I.store("2048-bertcarsouw",JSON.stringify(a))}}function s(){if(I.supported()){var a=I.retrieve("2048-bertcarsouw");if(null===a){x=0;for(var b=0;b<16;b++)z.push(0),h(b);y=0,d()}else if(a=JSON.parse(a),x=a.score,a.score||(x=0),y=a.highscore,a.highscore||(y=0),a.cells){z=a.cells;for(var c=!1,e=0;e<z.length;e++)z[e]>0?(c=!0,j(z[e],e)):h(e);c||d()}}else{for(var b=0;b<16;b++)z.push(0),h(b);d(),x=0,y=0}}function t(a){function b(){z[k]>0&&c.indexOf(k)===-1?0===z[k+e]?(l=!0,g(k,k+e,function(){k<16&&(z[k+e]=z[k],z[k]=0,i++,k=f[i],b())})):z[k+e]===z[k]&&m.indexOf(k)===-1?(l=!0,g(k,k+e,function(){k<16&&(z[k+e]=2*z[k],x+=z[k+e],p(),2048===z[k+e]&&n(),x>y&&(y=x,q()),m.push(k+e),z[k]=0,j(z[k+e],k+e),i++,k=f[i],b())})):(i++,k=f[i],b()):k<15?(i++,k=f[i],b()):(0!==h||l)&&(3===h?d():(h++,i=0,k=f[i],b()))}var c,e,f;a===T.UP?(c=O,e=-4,f=P):a===T.DOWN?(c=N,e=4,f=Q):a===T.LEFT?(c=L,e=-1,f=S):(c=M,e=1,f=R);var h=0,i=0,k=f[i],l=!1,m=[];b()}function u(a){F=a.touches[0].clientX,G=a.touches[0].clientY}function v(a){if(F&&G){var b=a.touches[0].clientX,c=a.touches[0].clientY,d=F-b,e=G-c;Math.abs(d)>Math.abs(e)?d>0?0===A&&t(T.LEFT):0===A&&t(T.RIGHT):e>0?0===A&&t(T.UP):0===A&&t(T.DOWN),F=null,G=null}}this.start=a;var w,x,y,z=[],A=0,B=850,C=200,D=10,E={TEXT_DARK:"#766D63",TEXT_LIGHT:"#FBF5F2",BACKGROUND:"#CDC0B4",BORDER:"#BBADA0",TWO:"#EEE4DA",FOUR:"#EDE0C8",EIGHT:"#F2B179",SIXTEEN:"#F59563",THIRTYTWO:"#F67C5F",SIXTYFOUR:"#F65E3B",ONEHUNDREDTWENTYEIGHT:"#EDCE72",TWOHUNDREDFIFTYSIX:"#EDCC62"},F=null,G=null,H=document.getElementById("score-board"),I=new Scores,J=document.getElementsByTagName("button")[0],K=document.getElementById("win-message"),L=[0,4,8,12],M=[3,7,11,15],N=[12,13,14,15],O=[0,1,2,3],P=[4,5,6,7,8,9,10,11,12,13,14,15],Q=[8,9,10,11,4,5,6,7,0,1,2,3],R=[2,6,10,14,1,5,9,13,0,4,8,12],S=[1,5,9,13,2,6,10,14,3,7,11,15],T={UP:1,DOWN:2,LEFT:3,RIGHT:4}}function Scores(){function a(){return"undefined"!=typeof Storage||(console.warn("no localstorage support"),!1)}function b(a,b){localStorage.setItem(a,b)}function c(a){return localStorage.getItem(a)}function d(a){localStorage.removeItem(a)}this.supported=a,this.store=b,this.retrieve=c,this.remove=d}